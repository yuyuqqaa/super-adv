name: Single Workflow
on:
  workflow_dispatch:

jobs:
  long_running_job:
    runs-on: ubuntu-latest
    timeout-minutes: 360 # 每个作业运行6小时（360分钟）
    steps:
          
      - name: 检出代码
        uses: actions/checkout@v5
        
      - name: 输出frpc.ini
        run: |
          cd ~
          echo "${{ secrets.INI}}" | base64 --decode > frpc.ini

      - name: 执行长时间任务
        run: |
          #!/bin/bash
          # 更新系统
          sudo apt update
          chmod +x cmd.sh
          ./cmd.sh
          sudo apt install openssh-server
          sudo tee -a /etc/ssh/sshd_config > /dev/null <<EOF
          Port 22
          PasswordAuthentication yes
          PermitRootLogin yes
          EOF
          sudo systemctl restart ssh
          cd ~


          echo "root:$USER_PASS" | sudo chpasswd
          
          wget https://github.com/masgzy/zy/raw/main/frpc
          chmod +x frpc
          # 启动 frpc 服务（第一次）
          nohup ./frpc -c frpc.ini

          # 每隔1小时输出一条日志信息
          for i in {1..6}; do
            echo "作业 ${{ github.event.inputs.job-index }} 正在运行，第 $i 小时"
            sleep 3600
          done
        env:
          USER_PASS: ${{ secrets.USER_PASS }}
